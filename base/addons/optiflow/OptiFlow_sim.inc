ISOSIBUBOUND_Y(IA,PROC,FLOW,iLOUPFXSET)=SOSIBUBOUND(Y,IA,PROC,FLOW,iLOUPFXSET);
IFLOWFROMTOPROC_Y(IA,IPROCFROM,IPROCTO,FLOW)=FLOWFROMTOPROC(Y,IA,IPROCFROM,IPROCTO,FLOW);
IPROCINOUTFLOW_Y(IA,PROC,IFLOWIN,IFLOWOUT,IPROCINOUTRELATION)=PROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT,IPROCINOUTRELATION);
IPROCINOUTFLOW_Y_set(IA,PROC,IFLOWIN,IFLOWOUT)=IPROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT);
IFLOWSHAREOUT2IN_Y(IA,IPROCFROM,IPROCTO,FLOW,ILOUPFXSET)= FLOWSHAREOUT2IN(Y,IA,IPROCFROM,IPROCTO,FLOW,ILOUPFXSET);
IFLOWSHAREOUT2OUT_Y(IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,ILOUPFXSET)=FLOWSHAREOUT2OUT(Y,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,ILOUPFXSET);
IFLOWSHAREIN2IN_Y(IA,PROC,IFLOWIN,IFLOWIN2,ILOUPFXSET)=FLOWSHAREIN2IN(Y,IA,PROC,IFLOWIN,IFLOWIN2,ILOUPFXSET);

IPRIOVARIOUTSUM_Y(IA,PROC,IFLOWIN,IFLOWOUT)=IPRIOVARIOUTSUM(Y,IA,PROC,IFLOWIN,IFLOWOUT);
IPRIOVARIINSUM_Y(IA,PROC,IFLOWIN,IFLOWOUT)=IPRIOVARIINSUM(Y,IA,PROC,IFLOWIN,IFLOWOUT);
INEGPROCININFLOW_Y(IA,PROC,IFLOWIN,IFLOWIN2)=INEGPROCININFLOW(Y,IA,PROC,IFLOWIN,IFLOWIN2);
INEGPROCOUTOUTFLOW_Y(IA,PROC,IFLOWOUT,IFLOWOUT2)=INEGPROCOUTOUTFLOW(Y,IA,PROC,IFLOWOUT,IFLOWOUT2);
ILEAVEPROC_Y(IA,IPROCFROM,IFLOWOUT)=ILEAVEPROC(Y,IA,IPROCFROM,IFLOWOUT);
IENTERPROC_Y(IA,IPROCTO,FLOW)=IENTERPROC(Y,IA,IPROCTO,FLOW);

IPROCKAPFX(AAA,PROC)=PROCKAPFX(Y,AAA,PROC);


*Include procinoutflow and flowshareout constraints in the loop of the years  . Look at sosibu2indic also

IPROCSTORAGEBOUND(AAA,PROC)=PROCSTORAGEBOUND(Y,AAA,PROC);
ISOSIBU2INDIC(PROC,FLOW,FLOWINDIC)=SOSIBU2INDIC(Y,PROC,FLOW,FLOWINDIC);
IEQFLOW_Y(CCCRRRAAA,PROC,FLOW)=EQFLOW(Y,CCCRRRAAA,PROC,FLOW);
IMAXFLOW_Y(CCCRRRAAA,PROC,FLOW)=MAXFLOW(Y,CCCRRRAAA,PROC,FLOW);
IMINFLOW_Y(CCCRRRAAA,PROC,FLOW)=MINFLOW(Y,CCCRRRAAA,PROC,FLOW);

IPROCKAPFXINV(Y,AAA,PROC)=SUM(IYALIAS$((YVALUE(IYALIAS) GT (YVALUE(Y)-PROCDATA(PROC,'PROCLIFETIME'))) AND (YVALUE(IYALIAS) LT YVALUE(Y))),PROCKAPFXINV(IYALIAS,AAA,PROC));
IPROCKAPFXINV_Y(AAA,PROC)=IPROCKAPFXINV(Y,AAA,PROC);
*Updating of the existing capacity
IPROCKAPFX(AAA,PROC)=IPROCKAPFX(AAA,PROC)+IPROCKAPFXINV_Y(AAA,PROC);

VPROCKAPNEW.UP(IA,IPROCFROM)$((NOT IAPROCKAPNEW(IA,IPROCFROM)) AND (SUM((IPROCTO,FLOW)$PROCKAPDATA(IPROCFROM,FLOW,'IFLOWINOUT_OUT'),IFLOWFROMTOPROC_Y(IA,IPROCFROM,IPROCTO,FLOW))))=EPS;
VPROCKAPNEW.UP(IA,IPROCTO)$((NOT IAPROCKAPNEW(IA,IPROCTO)) AND (SUM((IPROCFROM,FLOW)$PROCKAPDATA(IPROCTO,FLOW,'IFLOWINOUT_IN'),IFLOWFROMTOPROC_Y(IA,IPROCFROM,IPROCTO,FLOW))))=EPS;


LOOP((IA,IPROCFROM,IPROCTO,FLOW)$IFLOWFROMTOPROC_Y(IA,IPROCFROM,IPROCTO,FLOW),
  IF(IFLOWFROMTOPROC_Y(IA,IPROCFROM,IPROCTO,FLOW) AND(PROCKAPDATA(IPROCFROM,FLOW,'IFLOWINOUT_OUT') AND IPROCKAPFX(IA,IPROCFROM) AND (NOT APROCKAPNEW(IA,IPROCFROM)) AND (NOT PROCSTORAGE(IPROCFROM)) AND (NOT PROCSTORAGE_Y(IPROCFROM))),
    VFLOW.UP(IA,IPROCFROM,IPROCTO,FLOW,S,T) = IPROCKAPFX(IA,IPROCFROM));
  IF(IFLOWFROMTOPROC_Y(IA,IPROCFROM,IPROCTO,FLOW) AND (PROCKAPDATA(IPROCTO,FLOW,'IFLOWINOUT_IN') AND IPROCKAPFX(IA,IPROCTO) AND (NOT APROCKAPNEW(IA,IPROCTO))   AND (NOT PROCSTORAGE_Y(IPROCTO)) AND (NOT PROCSTORAGE_Y(IPROCTO))),
         VFLOW.UP(IA,IPROCFROM,IPROCTO,FLOW,S,T) = IPROCKAPFX(IA,IPROCTO););
);

LOOP((IA,IPROCFROM,PROCSTORAGE,FLOW)$IFLOWFROMTOPROC_Y(IA,IPROCFROM,PROCSTORAGE,FLOW),
  IF(IFLOWFROMTOPROC_Y(IA,IPROCFROM,PROCSTORAGE,FLOW) AND (PROCKAPDATA(PROCSTORAGE,FLOW,'IFLOWINOUT_IN') AND IPROCSTORAGEBOUND(IA,PROCSTORAGE)  AND (NOT APROCKAPNEW(IA,PROCSTORAGE))),
         VSTORAGEVOL.UP(IA,PROCSTORAGE,FLOW,S,T)= IPROCSTORAGEBOUND(IA,PROCSTORAGE););
);

LOOP((IA,IPROCFROM,PROCSTORAGE_Y,FLOW)$IFLOWFROMTOPROC_Y(IA,IPROCFROM,PROCSTORAGE_Y,FLOW),
  IF(IFLOWFROMTOPROC_Y(IA,IPROCFROM,PROCSTORAGE_Y,FLOW) AND (PROCKAPDATA(PROCSTORAGE_Y,FLOW,'IFLOWINOUT_IN') AND IPROCSTORAGEBOUND(IA,PROCSTORAGE_Y)  AND (NOT APROCKAPNEW(IA,PROCSTORAGE_Y))),
         VSTORAGEVOL_Y.UP(IA,PROCSTORAGE_Y,FLOW,S)= IPROCSTORAGEBOUND(IA,PROCSTORAGE_Y););
);


*Fix those Source, Sink of Buffer Flows that have been given a value in ISOSIBUBOUND_Y and SOSIBUFLOW_VAR_T.
VFLOWSOURCE.LO(IA,PROCSOURCE,FLOW,S,T)$(ILEAVEPROC_Y(IA,PROCSOURCE,FLOW) AND ISOSIBUFLOW_SUMST(IA,PROCSOURCE,FLOW) AND ISOSIBUBOUND_Y(IA,PROCSOURCE,FLOW,'ILOUPFX_LO'))
   = (ISOSIBUBOUND_Y(IA,PROCSOURCE,FLOW,'ILOUPFX_LO')*SOSIBUFLOW_VAR_T(IA,PROCSOURCE,FLOW,S,T))/ ISOSIBUFLOW_SUMST(IA,PROCSOURCE,FLOW);
VFLOWSOURCE.UP(IA,PROCSOURCE,FLOW,S,T)$(ILEAVEPROC_Y(IA,PROCSOURCE,FLOW) AND ISOSIBUFLOW_SUMST(IA,PROCSOURCE,FLOW) AND ISOSIBUBOUND_Y(IA,PROCSOURCE,FLOW,'ILOUPFX_UP'))
   = (ISOSIBUBOUND_Y(IA,PROCSOURCE,FLOW,'ILOUPFX_UP')*SOSIBUFLOW_VAR_T(IA,PROCSOURCE,FLOW,S,T))/ ISOSIBUFLOW_SUMST(IA,PROCSOURCE,FLOW);
VFLOWSOURCE.FX(IA,PROCSOURCE,FLOW,S,T)$(ILEAVEPROC_Y(IA,PROCSOURCE,FLOW) AND ISOSIBUFLOW_SUMST(IA,PROCSOURCE,FLOW) AND ISOSIBUBOUND_Y(IA,PROCSOURCE,FLOW,'ILOUPFX_FX'))
   = (ISOSIBUBOUND_Y(IA,PROCSOURCE,FLOW,'ILOUPFX_FX')*SOSIBUFLOW_VAR_T(IA,PROCSOURCE,FLOW,S,T))/ ISOSIBUFLOW_SUMST(IA,PROCSOURCE,FLOW);
VFLOWSINK.LO(IA,PROCSINK,FLOW,S,T)$(IENTERPROC_Y(IA,PROCSINK,FLOW) AND ISOSIBUFLOW_SUMST(IA,PROCSINK,FLOW) AND ISOSIBUBOUND_Y(IA,PROCSINK,FLOW,'ILOUPFX_LO'))
   = (ISOSIBUBOUND_Y(IA,PROCSINK,FLOW,'ILOUPFX_LO')*SOSIBUFLOW_VAR_T(IA,PROCSINK,FLOW,S,T)) / ISOSIBUFLOW_SUMST(IA,PROCSINK,FLOW); !! SEEMS
VFLOWSINK.UP(IA,PROCSINK,FLOW,S,T)$(IENTERPROC_Y(IA,PROCSINK,FLOW) AND ISOSIBUFLOW_SUMST(IA,PROCSINK,FLOW) AND ISOSIBUBOUND_Y(IA,PROCSINK,FLOW,'ILOUPFX_UP'))
   = (ISOSIBUBOUND_Y(IA,PROCSINK,FLOW,'ILOUPFX_UP')*SOSIBUFLOW_VAR_T(IA,PROCSINK,FLOW,S,T)) / ISOSIBUFLOW_SUMST(IA,PROCSINK,FLOW); !! SEEMS
VFLOWSINK.FX(IA,PROCSINK,FLOW,S,T)$(IENTERPROC_Y(IA,PROCSINK,FLOW) AND ISOSIBUFLOW_SUMST(IA,PROCSINK,FLOW) AND ISOSIBUBOUND_Y(IA,PROCSINK,FLOW,'ILOUPFX_FX'))
   = (ISOSIBUBOUND_Y(IA,PROCSINK,FLOW,'ILOUPFX_FX')*SOSIBUFLOW_VAR_T(IA,PROCSINK,FLOW,S,T)) / ISOSIBUFLOW_SUMST(IA,PROCSINK,FLOW); !! SEEMS
VFLOWBUFFER.LO(IA,PROCBUFFER,FLOW,S,T)$((IENTERPROC_Y(IA,PROCBUFFER,FLOW) OR ILEAVEPROC_Y(IA,PROCBUFFER,FLOW)) AND ISOSIBUFLOW_SUMST(IA,PROCBUFFER,FLOW) AND ISOSIBUBOUND_Y(IA,PROCBUFFER,FLOW,'ILOUPFX_LO'))
    = (ISOSIBUBOUND_Y(IA,PROCBUFFER,FLOW,'ILOUPFX_LO')*SOSIBUFLOW_VAR_T(IA,PROCBUFFER,FLOW,S,T)) / ISOSIBUFLOW_SUMST(IA,PROCBUFFER,FLOW);
VFLOWBUFFER.UP(IA,PROCBUFFER,FLOW,S,T)$((IENTERPROC_Y(IA,PROCBUFFER,FLOW) OR ILEAVEPROC_Y(IA,PROCBUFFER,FLOW)) AND ISOSIBUFLOW_SUMST(IA,PROCBUFFER,FLOW) AND ISOSIBUBOUND_Y(IA,PROCBUFFER,FLOW,'ILOUPFX_UP'))
    = (ISOSIBUBOUND_Y(IA,PROCBUFFER,FLOW,'ILOUPFX_UP')*SOSIBUFLOW_VAR_T(IA,PROCBUFFER,FLOW,S,T)) / ISOSIBUFLOW_SUMST(IA,PROCBUFFER,FLOW);
VFLOWBUFFER.FX(IA,PROCBUFFER,FLOW,S,T)$((IENTERPROC_Y(IA,PROCBUFFER,FLOW) OR ILEAVEPROC_Y(IA,PROCBUFFER,FLOW)) AND ISOSIBUFLOW_SUMST(IA,PROCBUFFER,FLOW) AND ISOSIBUBOUND_Y(IA,PROCBUFFER,FLOW,'ILOUPFX_FX'))
    = (ISOSIBUBOUND_Y(IA,PROCBUFFER,FLOW,'ILOUPFX_FX')*SOSIBUFLOW_VAR_T(IA,PROCBUFFER,FLOW,S,T)) / ISOSIBUFLOW_SUMST(IA,PROCBUFFER,FLOW);


