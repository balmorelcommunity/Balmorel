EQUATION QOBJQ                                                 "Objective function value assuming parameterised quantities technique (U)";
EQUATION QOBJWQ                                                "Objective function value assuming weighted objectives values and parameterised quantities technique (U)";
EQUATION QNODEBALANCE(Y,AAA,PROC,IFLOWIN,IFLOWOUT,S,T)         "Balance of input and output FLOW in interior PROC (U/h)";
EQUATION QSOURCENODEBALANCE(Y,AAA,PROCSOURCE,FLOW,S,T)         "Balance at Source node (U/h)";
EQUATION QSINKNODEBALANCE(Y,AAA,PROCSINK,FLOW,S,T)             "Balance at Sink node (U/h)";
EQUATION QBUFFERNODEBALANCE(Y,AAA,PROCBUFFER,FLOW,S,T)         "Heat balance in district heating networks - NEJ generel, but includes Heat balance.. (U/h)";
EQUATION QFLOWTBALANCE(Y,AAA,IPROCFROM,IPROCTO,FLOW,S,T);

EQUATION QSTORAGEBALANCE(Y,AAA,PROC,FLOW,S,T)                   "Balance at TimeLinkstorage node";
EQUATION QSTORAGEBALANCE_Y(Y,AAA,PROC,FLOW,S)                   "Balance of Annual Storage";
EQUATION QSTORAGEBALANCE_YT(Y,AAA,PROC,FLOW,S,T);
EQUATION QSTOVOLTLIM_T(Y,AAA,PROC,FLOW,S,T)                     "T Storage capacity (MWh/ton)"
EQUATION QSTOVOLTLIM(Y,AAA,PROC,FLOW,S)                        "S storage capacity (MWh/ton)" ;
*Capacity constraint of storages yt is need

EQUATION QRAMPUPPROC(Y,AAA,IPROCFROM,IPROCTO,FLOW,S,T)        "Ramping up between time slices for units"
EQUATION QRAMPDOWNPROC(Y,AAA,IPROCFROM,IPROCTO,FLOW,S,T)     "Ramping down between time slices for units"


EQUATION QFLOWSHAREOUT2INUP(Y,AAA,PROC,IFLOWIN,IFLOWOUT,S,T) "Maximum shares (of inFlow) of split FLOWs leaving PROC as outFlow (share)";
EQUATION QFLOWSHAREOUT2INLO(Y,AAA,PROC,IFLOWIN,IFLOWOUT,S,T) "Minimum shares (of inFlow) of split FLOWs leaving PROC as outFlow (share)";
EQUATION QFLOWSHAREOUT2INFX(Y,AAA,PROC,IFLOWIN,IFLOWOUT,S,T) "Fixed shares (of inFlow) of split FLOWs leaving PROC as outFlow (share)";
EQUATION QFLOWSHAREOUT2OUTLO(Y,AAA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,S,T) "Lower value of relation (index 4 divided by 5) between two split FLOWs leaving PROC (share)";
EQUATION QFLOWSHAREOUT2OUTUP(Y,AAA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,S,T) "Upper value of relation (index 4 divided by 5) between two split FLOWs leaving PROC (share)";
EQUATION QFLOWSHAREOUT2OUTFX(Y,AAA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,S,T) "Fixed relation (index 4 divided by 5) between two split FLOWs leaving PROC (share)";
EQUATION QFLOWSHAREIN2INUP(Y,AAA,IPROCFROM,IPROCFROM2,PROC,IFLOWIN,IFLOWIN2,S,T) "Maximum Relationship of two inFLOWS to a PROC (relation of U1/U2)";
EQUATION QFLOWSHAREIN2INLO(Y,AAA,IPROCFROM,IPROCFROM2,PROC,IFLOWIN,IFLOWIN2,S,T) "Minimum Relationship of two inFLOWS to a PROC (relation of U1/U2)";
EQUATION QFLOWSHAREIN2INFX(Y,AAA,IPROCFROM,IPROCFROM2,PROC,IFLOWIN,IFLOWIN2,S,T) "Fixed Relationship of two inFLOWS to a PROC (relation of U1/U2)";

EQUATION QTRANSITNODEBALANCE(Y,AAATRANSIT,PROC,FLOW,S,T)       "Balance of input and output FLOW in Transit PROC (U/h)"

EQUATION QINDICQUANT(Y,FLOWINDIC)                              "Total quantity of INDIC (U)"
EQUATION QINDICINDICMIN(Y,FLOWINDIC)                             "Minimal annual quantity of INDIC (U)";
EQUATION QINDICINDICMAX(Y,FLOWINDIC)                             "Maximal annual quantity (sum-of-years) of INDIC (U)";

EQUATION QEQFLOW_A(Y,AAA,PROC,FLOW)  "Constraint of FLOW consumption equals to a value in an Area in a Source,Buffer or Sink Process"
EQUATION QEQFLOW_R(Y,RRR,PROC,FLOW)  "Constraint of FLOW consumption equals to a value in a Region in a Source,Buffer or Sink Buffer Process"
EQUATION QEQFLOW_C(Y,C,PROC,FLOW)   "Constraint of FLOW consumption equals to a value in a Country in a Source,Buffer or Sink Buffer Process"
EQUATION QMAXFLOW_A(Y,AAA,PROC,FLOW)  "Constraint of FLOW consumption equals to a value in an Area in a Source,Buffer or Sink Process"
EQUATION QMAXFLOW_R(Y,RRR,PROC,FLOW)  "Constraint of FLOW consumption equals to a value in a Region in a Source,Buffer or Sink Buffer Process"
EQUATION QMAXFLOW_C(Y,C,PROC,FLOW)   "Constraint of FLOW consumption equals to a value in a Country in a Source,Buffer or Sink Buffer Process"
EQUATION QMINFLOW_A(Y,AAA,PROC,FLOW)  "Constraint of FLOW consumption equals to a value in an Area in a Source,Buffer or Sink Process"
EQUATION QMINFLOW_R(Y,RRR,PROC,FLOW)  "Constraint of FLOW consumption equals to a value in a Region in a Source,Buffer or Sink Buffer Process"
EQUATION QMINFLOW_C(Y,C,PROC,FLOW)   "Constraint of FLOW consumption equals to a value in a Country in a Source,Buffer or Sink Buffer Process"

;
*-------------------------------------------------------------------------------
*----- Any declarations and definitions of equations for addon:
*-------------------------------------------------------------------------------

$ifi %inv%==yes  EQUATION QPROCKAPACCUMNET(Y,AAA,PROC)             'NOT FINISHED Accumulated new investments minus decommissioning of previous investments due to lifetime expiration available at beginning of next year (U/h)';
$ifi %inv%==yes  EQUATION QPROCKAP_UP(Y,AAA,IPROCFROM,IPROCTO,FLOW,S,T)           'Capacity constraint on ..... (U/h)';
$ifi %inv%==yes  EQUATION QPROCKAUP_SCALE1(Y,AAA,PROC)   "Equation for modelling economy of scale of new investments" ;
$ifi %inv%==yes  EQUATION QPROCKAUP_SCALE2(Y,AAA,PROC)   "Equation for modelling economy of scale of new investments"  ;
$ifi %inv%==yes  EQUATION QPROCKAP_DEC(Y,AAA,IPROCFROM,IPROCTO,FLOW,S,T) "Equation for modelling of decomissioning plants";



* Flows from SOSIBU and EXIM in units [U/h] are indic-weighted, time-weighted and summarized.
QINDICQUANT(IY411,FLOWINDIC)..
  VFLOWINDICVALUES(IY411,FLOWINDIC) =E=
* SoSiBu processes in PROC_T:
  SUM((IS3,T), IHOURSINST(IS3,T)*(
    SUM((IA,PROCSOURCE,FLOW)$(PROC_T(PROCSOURCE) AND SOSIBU2INDIC(IY411,PROCSOURCE,FLOW,FLOWINDIC)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,T)$(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC(IY411,PROCSOURCE,FLOW,FLOWINDIC))
  + SUM((IA,PROCSOURCE,FLOW)$(PROC_T(PROCSOURCE) AND SOSIBU2INDIC_A(IA,PROCSOURCE,FLOW,FLOWINDIC)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,T)$(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC_A(IA,PROCSOURCE,FLOW,FLOWINDIC))
  + SUM((IA,PROCSOURCE,FLOW)$(PROC_T(PROCSOURCE) AND SOSIBU2INDIC_AS(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,T)$(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC_AS(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3))
  + SUM((IA,PROCSOURCE,FLOW)$(PROC_T(PROCSOURCE) AND SOSIBU2INDIC_AST(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3,T)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,T)$(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC_AST(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3,T))
  + SUM((IR,IA)$RRRAAA(IR,IA), SUM((PROCSOURCE,FLOW)$(PROC_T(PROCSOURCE) AND SOSIBU2INDIC_RST(IR,PROCSOURCE,FLOW,FLOWINDIC,IS3,T)), VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,T)$(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW))) * SOSIBU2INDIC_RST(IR,PROCSOURCE,FLOW,FLOWINDIC,IS3,T)))

  + SUM((IA,PROCSINK,FLOW)$(PROC_T(PROCSINK) AND SOSIBU2INDIC(IY411,PROCSINK,FLOW,FLOWINDIC)),    VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,T)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW)))* SOSIBU2INDIC(IY411,PROCSINK,FLOW,FLOWINDIC))
  + SUM((IA,PROCSINK,FLOW)$(PROC_T(PROCSINK) AND SOSIBU2INDIC_A(IA,PROCSINK,FLOW,FLOWINDIC)),    VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,T)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW))) * SOSIBU2INDIC_A(IA,PROCSINK,FLOW,FLOWINDIC))
  + SUM((IA,PROCSINK,FLOW)$(PROC_T(PROCSINK) AND SOSIBU2INDIC_AS(IA,PROCSINK,FLOW,FLOWINDIC,IS3)),    VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,T)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW))) * SOSIBU2INDIC_AS(IA,PROCSINK,FLOW,FLOWINDIC,IS3))
  + SUM((IA,PROCSINK,FLOW)$(PROC_T(PROCSINK) AND SOSIBU2INDIC_AST(IA,PROCSINK,FLOW,FLOWINDIC,IS3,T)),    VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,T)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW))) * SOSIBU2INDIC_AST(IA,PROCSINK,FLOW,FLOWINDIC,IS3,T))
  + SUM((IR,IA)$RRRAAA(IR,IA), SUM((PROCSINK,FLOW)$(PROC_T(PROCSINK) AND SOSIBU2INDIC_RST(IR,PROCSINK,FLOW,FLOWINDIC,IS3,T)), VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,T)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW))) * SOSIBU2INDIC_RST(IR,PROCSINK,FLOW,FLOWINDIC,IS3,T)))

  + SUM((IA,PROCBUFFER,FLOW)$(PROC_T(PROCBUFFER)AND SOSIBU2INDIC(IY411,PROCBUFFER,FLOW,FLOWINDIC) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,T) * SOSIBU2INDIC(IY411,PROCBUFFER,FLOW,FLOWINDIC))                                       !!  Reconsider sign and generality; note that VBUFFER  is free
  + SUM((IA,PROCBUFFER,FLOW)$(PROC_T(PROCBUFFER) AND SOSIBU2INDIC_A(IA,PROCBUFFER,FLOW,FLOWINDIC) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,T) * SOSIBU2INDIC_A(IA,PROCBUFFER,FLOW,FLOWINDIC))
  + SUM((IA,PROCBUFFER,FLOW)$(PROC_T(PROCBUFFER) AND SOSIBU2INDIC_AS(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,T) * SOSIBU2INDIC_AS(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3))
  + SUM((IA,PROCBUFFER,FLOW)$(PROC_T(PROCBUFFER) AND SOSIBU2INDIC_AST(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3,T) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,T) * SOSIBU2INDIC_AST(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3,T))                          !!  Reconsider sign and generality; note that VBUFFER  is free
  + SUM((IR,IA)$RRRAAA(IR,IA), SUM((PROCBUFFER,FLOW)$(PROC_T(PROCBUFFER) AND SOSIBU2INDIC_RST(IR,PROCBUFFER,FLOW,FLOWINDIC,IS3,T) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))), VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,T) * SOSIBU2INDIC_RST(IR,PROCBUFFER,FLOW,FLOWINDIC,IS3,T)))  !!  Reconsider sign and generality; note that VBUFFER  is free

* TODO: why use $(TRANSDIST(IAE,IAI) NE NA), why not use $TRANSDIST(IAE,IAI) (see data table) ?
  + SUM((IAE,IAI,PROCEXIM,IFLOWEXIM)$(TRANSDIST(PROCEXIM,IAE,IAI) AND (PROC_T(PROCEXIM)) AND PROCINOUTFLOW(IY411,IAE,PROCEXIM,IFLOWEXIM,IFLOWEXIM,"IONEONE")), ((TRANSDIST(PROCEXIM,IAE,IAI)*TRANSCOST('TCDMONEYDISTFLOW','ITRANSDWDISTWEIGHT',PROCEXIM,FLOWINDIC)
+TRANSCOST('TCDMONEYFLOW','ITRANSDWWEIGHT',PROCEXIM,FLOWINDIC))*VFLOWTRANS(IY411,IAE,IAI,PROCEXIM,IFLOWEXIM,IS3,T))$(NOT TRANSFLOWMAX(IAE,IAI,PROCEXIM,IFLOWEXIM)))
  ))
* SoSiBu processes not in PROC_T:
+ SUM((IS3,ITWWT), IHOURSINST(IS3,ITWWT)*(   !! Hans 20141030: ITWWT -> T   :
*+ SUM((IS3,T), IHOURSINST(IS3,T)*(
    SUM(T, !! Acts as a selector of the single element in ITWWT
    SUM((IA,PROCSOURCE,FLOW)$(NOT PROC_T(PROCSOURCE) AND SOSIBU2INDIC(IY411,PROCSOURCE,FLOW,FLOWINDIC)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,ITWWT) $(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC(IY411,PROCSOURCE,FLOW,FLOWINDIC))
  + SUM((IA,PROCSOURCE,FLOW)$(NOT PROC_T(PROCSOURCE)AND SOSIBU2INDIC_A(IA,PROCSOURCE,FLOW,FLOWINDIC)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,ITWWT) $(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC_A(IA,PROCSOURCE,FLOW,FLOWINDIC))
  + SUM((IA,PROCSOURCE,FLOW)$(NOT PROC_T(PROCSOURCE)AND SOSIBU2INDIC_AS(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,ITWWT) $(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC_AS(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3))
  + SUM((IA,PROCSOURCE,FLOW)$(NOT PROC_T(PROCSOURCE) AND SOSIBU2INDIC_AST(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3,ITWWT)),  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,ITWWT) $(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC_AST(IA,PROCSOURCE,FLOW,FLOWINDIC,IS3,ITWWT))
  + SUM((IR,IA)$RRRAAA(IR,IA), SUM((PROCSOURCE,FLOW)$(NOT PROC_T(PROCSOURCE) AND SOSIBU2INDIC_RST(IR,PROCSOURCE,FLOW,FLOWINDIC,IS3,ITWWT)), VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,IS3,ITWWT) $(SUM(IPROCTO,FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW)))* SOSIBU2INDIC_RST(IR,PROCSOURCE,FLOW,FLOWINDIC,IS3,ITWWT)))

  + SUM((IA,PROCSINK,FLOW)$(NOT PROC_T(PROCSINK) AND SOSIBU2INDIC(IY411,PROCSINK,FLOW,FLOWINDIC)),      VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,ITWWT)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW)))*  SOSIBU2INDIC(IY411,PROCSINK,FLOW,FLOWINDIC))
  + SUM((IA,PROCSINK,FLOW)$(NOT PROC_T(PROCSINK) AND SOSIBU2INDIC_A(IA,PROCSINK,FLOW,FLOWINDIC)),      VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,ITWWT)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW))) * SOSIBU2INDIC_A(IA,PROCSINK,FLOW,FLOWINDIC))
  + SUM((IA,PROCSINK,FLOW)$(NOT PROC_T(PROCSINK) AND SOSIBU2INDIC_AS(IA,PROCSINK,FLOW,FLOWINDIC,IS3)),      VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,ITWWT)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW))) * SOSIBU2INDIC_AS(IA,PROCSINK,FLOW,FLOWINDIC,IS3))
  + SUM((IA,PROCSINK,FLOW)$(NOT PROC_T(PROCSINK) AND SOSIBU2INDIC_AST(IA,PROCSINK,FLOW,FLOWINDIC,IS3,ITWWT)),      VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,ITWWT)$(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW))) * SOSIBU2INDIC_AST(IA,PROCSINK,FLOW,FLOWINDIC,IS3,ITWWT))
  + SUM((IR,IA)$RRRAAA(IR,IA), SUM((PROCSINK,FLOW)$(NOT PROC_T(PROCSINK) AND SOSIBU2INDIC_RST(IR,PROCSINK,FLOW,FLOWINDIC,IS3,ITWWT)), VFLOWSINK(IY411,IA,PROCSINK,FLOW,IS3,ITWWT) $(SUM(IPROCFROM,FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW)))* SOSIBU2INDIC_RST(IR,PROCSINK,FLOW,FLOWINDIC,IS3,ITWWT)))

  + SUM((IA,PROCBUFFER,FLOW)$(NOT PROC_T(PROCBUFFER) AND SOSIBU2INDIC(IY411,PROCBUFFER,FLOW,FLOWINDIC) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,ITWWT) * SOSIBU2INDIC(IY411,PROCBUFFER,FLOW,FLOWINDIC))
  + SUM((IA,PROCBUFFER,FLOW)$(NOT PROC_T(PROCBUFFER) AND SOSIBU2INDIC_A(IA,PROCBUFFER,FLOW,FLOWINDIC) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,ITWWT) * SOSIBU2INDIC_A(IA,PROCBUFFER,FLOW,FLOWINDIC))                                        !!  Reconsider sign and generality; note that VBUFFER  is free
  + SUM((IA,PROCBUFFER,FLOW)$(NOT PROC_T(PROCBUFFER) AND SOSIBU2INDIC_AS(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,ITWWT) * SOSIBU2INDIC_AS(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3))                                        !!  Reconsider sign and generality; note that VBUFFER  is free
  + SUM((IA,PROCBUFFER,FLOW)$(NOT PROC_T(PROCBUFFER)  AND SOSIBU2INDIC_AST(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3,ITWWT) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))),  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,ITWWT) * SOSIBU2INDIC_AST(IA,PROCBUFFER,FLOW,FLOWINDIC,IS3,ITWWT))                          !!  Reconsider sign and generality; note that VBUFFER  is free
  + SUM((IR,IA)$RRRAAA(IR,IA), SUM((PROCBUFFER,FLOW)$(NOT PROC_T(PROCBUFFER) AND SOSIBU2INDIC_RST(IR,PROCBUFFER,FLOW,FLOWINDIC,IS3,ITWWT) AND(SUM((IPROCFROM)$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1))), VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,IS3,ITWWT) * SOSIBU2INDIC_RST(IR,PROCBUFFER,FLOW,FLOWINDIC,IS3,ITWWT)))  !!  Reconsider sign and generality; note that VBUFFER  is free

* TODO: why use $(TRANSDIST(IAE,IAI) NE NA), why not use $TRANSDIST(IAE,IAI) (see data table) ?
  + SUM((IAE,IAI,PROCEXIM,IFLOWEXIM)$(TRANSDIST(PROCEXIM,IAE,IAI) AND (NOT PROC_T(PROCEXIM)) AND PROCINOUTFLOW(IY411,IAE,PROCEXIM,IFLOWEXIM,IFLOWEXIM,"IONEONE")), ((TRANSDIST(PROCEXIM,IAE,IAI)*TRANSCOST('TCDMONEYDISTFLOW','ITRANSDWDISTWEIGHT',PROCEXIM,FLOWINDIC)+TRANSCOST('TCDMONEYFLOW','ITRANSDWWEIGHT',PROCEXIM,FLOWINDIC))*VFLOWTRANS(IY411,IAE,IAI,PROCEXIM,IFLOWEXIM,IS3,ITWWT))$(NOT TRANSFLOWMAX(IAE,IAI,PROCEXIM,IFLOWEXIM)))
  )))
;


* "Objective function value assuming parameterised quantities technique"
* ihoursinst todo
QOBJQ..
   VOBJQ =E= 1; !! Essentially Rubbish - this functionality is sketched only

* "Objective function value assuming weighted objectives values and parameterised quantities technique"
* ihoursinst todo
QOBJWQ ..
   VOBJWQ =E=1;   !! Essentially Rubbish - this functionality is sketched only

* Interpretation info:
* Debug info: In the Column listing for VFLOW in the GAMS list file the coefficient shown for QNODEBALANCE is normally (except:...) positive for the NODE that VFLOW enters and negative for the NODE from which VFLOW leaves .
* Note: the input (left hand) side is more complex than the output side, mainly because PROCINOUTFLOW is multiplied to the input side.
* Note: the SUM acts as selector rather than summation except where noted.

QNODEBALANCE(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T)$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)
                                              AND (IPRIOVARIOUTSUM(IY411,IA,PROC,IFLOWIN,IFLOWOUT) LE 1)
                                              AND (IPRIOVARIINSUM(IY411,IA,PROC,IFLOWIN,IFLOWOUT) LE 1)
                                              AND (NOT (PROCSTORAGE(PROC) AND IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)$SAMEAS(IFLOWIN,IFLOWOUT)))
                                              AND (NOT (PROCSTORAGE_Y(PROC) AND IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)$SAMEAS(IFLOWIN,IFLOWOUT)))
                                              AND (NOT (PROCSTORAGE_YT(PROC) AND IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)$SAMEAS(IFLOWIN,IFLOWOUT)))
                                              AND IPROCTIMESETS(PROC,T))
..


* FLOW into PROC:
* One or two inFLOW in fixed propotions:
  + SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) AND (IPRIOVARIINSUM(IY411,IA,PROC,IFLOWIN,IFLOWOUT) EQ 0) AND (IPRIOVARIOUTSUM(IY411,IA,PROC,IFLOWIN,IFLOWOUT) EQ 0)),
* One inFLOW with fixed relation to one FLOW:
    + (VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)*PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONE"))$((NOT INEGPROCININFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONE"))
    + (VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T))                                          $((NOT INEGPROCININFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONEREC"))
* Two inFLOW (both FLOWIN are FLOWOUT are entering PROC in fixed proportions (nothing will be entered on the other side of =E=)):
    - (VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)*PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONE"))$(    INEGPROCININFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT))
    - SUM(IPROCFROM2$(FLOWFROMTOPROC(IY411,IA,IPROCFROM2,PROC,IFLOWOUT) AND INEGPROCININFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)), VFLOW(IY411,IA,IPROCFROM2,PROC,IFLOWOUT,S,T))
 )
* The single inFLOW that is split on two or more outFLOW with IONEMANY:
 + SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")), VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)) !!IPRIOVARIOUTSUM_Y som ovenfor

* The multiple inFLOW that are summarized into a single outFLOW (SUM acts as summation):
  + SUM((IPROCFROM,FLOW)$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,FLOW) AND (PROCINOUTFLOW(IY411,IA,PROC, FLOW,IFLOWOUT,"IMANYONE"))),
   VFLOW(IY411,IA,IPROCFROM,PROC, FLOW,S,T)*PROCINOUTFLOW(IY411,IA,PROC, FLOW,IFLOWOUT,"IMANYONE"))



* Import from other areas:
  + SUM(IAE$ITRANSFROMTO(IAE,IA),VFLOWTRANS(IY411,IAE,IA,PROC,IFLOWIN,S,T)$(NOT TRANSFLOWMAX(IAE,IA,PROC,IFLOWIN)))$PROCEXIM(PROC)

=E=

* FLOW out from PROC:
* One or two outFLOW in fixed proportions:
  + SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND (IPRIOVARIINSUM(IY411,IA,PROC,IFLOWIN,IFLOWOUT) EQ 0) AND (IPRIOVARIOUTSUM(IY411,IA,PROC,IFLOWIN,IFLOWOUT) EQ 0)),
* One outFLOW with fixed relation to one FLOW:
      VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T)                                            $(NOT INEGPROCOUTOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONE"))
    + (VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T)*PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONEREC"))$(NOT INEGPROCOUTOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONEREC"))

* Two outFLOW (both FLOWIN are FLOWOUT are leaving PROC in fixed proportions (nothing will be entered on the other side of =E=)):
    + VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T)$INEGPROCOUTOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)
    + SUM(IPROCTO2$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO2,IFLOWIN) AND INEGPROCOUTOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)),
      VFLOW(IY411,IA,PROC,IPROCTO2,IFLOWIN,S,T)*PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEONE")  )
       )
* The single outFLOW that is summarized from two or more inFLOW with IMANYONE:
  + SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND (PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IMANYONE"))), VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T)*PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IMANYONE"))

* The multiple outFLOW that are coming from a single inFLOW (SUM acts as summation):
  + SUM((IPROCTO,FLOW)$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,FLOW) AND (PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,FLOW,"IONEMANY"))), !!TODO: compare §§ above: why different
     VFLOW(IY411,IA,PROC,IPROCTO,FLOW,S,T)*PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,FLOW,"IONEMANY"))
* Export to other areas:
  + SUM(IAI$(ITRANSFROMTO(IA,IAI)),VFLOWTRANS(IY411,IA,IAI,PROC,IFLOWOUT,S,T)$(NOT TRANSFLOWMAX(IA,IAI,PROC,IFLOWOUT)))$PROCEXIM(PROC)

* Slack:
$ifi %useQNODEslack%==yes  +(VQNODEBALANCE(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T,'IMINUS')-VQNODEBALANCE(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T,'IPLUS'))$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT))

;

QFLOWTBALANCE(IY411,IA,IPROCFROM,IPROCTO,IFLOW_T,S,T)$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,IFLOW_T) AND ((NOT PROC_T(IPROCFROM)) OR (NOT PROC_T(IPROCTO))))..
VFLOW(IY411,IA,IPROCFROM,IPROCTO,IFLOW_T,S,T)=E=SUM(ITWWT,VFLOW(IY411,IA,IPROCFROM,IPROCTO,IFLOW_T,S,ITWWT));



** Observe: if no FLOW is brought from a Source then VSOURCE is equated to zero.
* Note: the SUM(TWWT,...) serves as a selector of the single time element TWWT.

QSOURCENODEBALANCE(IY411,IA,PROCSOURCE,FLOW,S,T)$((SUM(IPROCTO$FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW),1)) AND IPROCTIMESETS(PROCSOURCE,T))..
  VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)$PROC_T(PROCSOURCE)
 +SUM(ITWWT, VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT))$(NOT PROC_T(PROCSOURCE))
  =E=
  SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW) AND (NOT PROC_T(IPROCTO))), SUM(ITWWT, VFLOW(IY411,IA,PROCSOURCE,IPROCTO,FLOW,S,ITWWT)))
 +SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROCSOURCE,IPROCTO,FLOW) AND (PROC_T(IPROCTO))),     VFLOW(IY411,IA,PROCSOURCE,IPROCTO,FLOW,S,T))

$ifi %useSSBslack%==yes  +SUM(ILOUPFXSET$SOSIBUBOUND(IY411,IA,PROCSOURCE,FLOW,ILOUPFXSET),VQSOURCEBALANCE(IY411,IA,PROCSOURCE,FLOW,S,T,'IMINUS') - VQSOURCEBALANCE(IY411,IA,PROCSOURCE,FLOW,S,T,'IPLUS'))
;

* further development of  Amalia - Have a look at this comments, I think most of these issues have already been solved, if a PROC_T process is linked to a
*non PROC_T process, the flow of the PROC_T process linked, has to be defined as IFLOW_T
*   Comments: 0. here assued that procsink may be in either proc_t or not proc_t
*             1. by assumption (and checked in error2.inc) two proc that are linked must both be in proc_t of both not in proc_t
*             2. Even if IPROCFROM is PROCSTORAGE then this is not to be reflected here (cf. qnodebalance, and note that PROCSINK is not PROCSTORAGE)
*             3. A consequence is that e.g. procbuffer GHG has to be split into GHG and GHG_T, and linked to appropriate internal processes?
* More general comment/todo: Implement code such that PROCSTORAGE may be in either proc_t or not proc_t?

* Observe: if no FLOW is brougt to a Sink then VSINK is equated to zero.
QSINKNODEBALANCE(IY411,IA,PROCSINK,FLOW,S,T)$((SUM(IPROCFROM$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW),1)) AND IPROCTIMESETS(PROCSINK,T))..
  SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW) AND (PROC_T(IPROCFROM))), VFLOW(IY411,IA,IPROCFROM,PROCSINK,FLOW,S,T))
 +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSINK,FLOW) AND (NOT PROC_T(IPROCFROM))),  SUM(ITWWT, VFLOW(IY411,IA,IPROCFROM,PROCSINK,FLOW,S,ITWWT)))
=E=
  VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)$PROC_T(PROCSINK)
 +SUM(ITWWT,VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT))$(NOT PROC_T(PROCSINK))

$ifi %useSSBslack%==yes  -SUM(ILOUPFXSET$SOSIBUBOUND(IY411,IA,PROCSINK,FLOW,ILOUPFXSET),VQSINKBALANCE(IY411,IA,PROCSINK,FLOW,S,T,'IPLUS') - VQSINKBALANCE(IY411,IA,PROCSINK,FLOW,S,T,'IMINUS'))
;

QBUFFERNODEBALANCE(IY411,IA,PROCBUFFER,FLOW,S,T)$(IPROCTIMESETS(PROCBUFFER,T) AND (SUM(IPROCFROM$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW),1) OR SUM((IPROCTO)$FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW),1)))..
 +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCBUFFER,FLOW)), VFLOW(IY411,IA,IPROCFROM,PROCBUFFER,FLOW,S,T))
 -SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROCBUFFER,IPROCTO,FLOW)),       VFLOW(IY411,IA,PROCBUFFER,IPROCTO,FLOW,S,T))
 =E=
  VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)

$ifi %useSSBslack%==yes  +SUM(ILOUPFXSET$SOSIBUBOUND(IY411,IA,PROCBUFFER,FLOW,ILOUPFXSET),VQBUFFERBALANCE(IY411,IA,PROCBUFFER,FLOW,S,T,'IMINUS')-VQBUFFERBALANCE(IY411,IA,PROCBUFFER,FLOW,S,T,'IPLUS')) !! Sign?? TODO !!
;


* Note: the leaving and entering flows are of same quality, therefore sufficient with "$(SUM(IPROCFROM$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE,FLOW),1))"
QSTORAGEBALANCE(IY411,IA,PROCSTORAGE,FLOW,S,T)$((SUM(IPROCFROM$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE,FLOW),1))
                                           AND IPROCINOUTFLOW(IY411,IA,PROCSTORAGE,FLOW,FLOW))..

VSTORAGEVOL(IY411,IA,PROCSTORAGE,FLOW,S,T++1)

=E=

VSTORAGEVOL(IY411,IA,PROCSTORAGE,FLOW,S,T)

* Entering Flow (indexed over time segments (S,ITWWT)):
 +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE,FLOW) AND (NOT PROC_T(IPROCFROM))),
  SUM(ITWWT,VFLOW(IY411,IA,IPROCFROM,PROCSTORAGE,FLOW,S,ITWWT)*PROCINOUTFLOW(IY411,IA,PROCSTORAGE,FLOW,FLOW,'IONEONE'))*(IHOURSINST(S,T)*(CARD(S)/CARD(SSS))*(1/CYCLES(T))) )
* Entering Flow (indexed over time segments (S,T)):
 +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE,FLOW) AND (PROC_T(IPROCFROM))),
  VFLOW(IY411,IA,IPROCFROM,PROCSTORAGE,FLOW,S,T)*PROCINOUTFLOW(IY411,IA,PROCSTORAGE,FLOW,FLOW,'IONEONE')*(IHOURSINST(S,T)*(CARD(S)/CARD(SSS))*(1/CYCLES(T))))

* Leaving FLOW (indexed over time segments (S,ITWWT)):
-SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROCSTORAGE,IPROCTO,FLOW) AND (NOT PROC_T(IPROCTO))),
 SUM(ITWWT,VFLOW(IY411,IA,PROCSTORAGE,IPROCTO,FLOW,S,ITWWT))*(IHOURSINST(S,T)*(CARD(S)/CARD(SSS))*(1/CYCLES(T))))
* Leaving FLOW (indexed over time segments (S,T)):
-SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROCSTORAGE,IPROCTO,FLOW) AND (PROC_T(IPROCTO))),
 VFLOW(IY411,IA,PROCSTORAGE,IPROCTO,FLOW,S,T)*(IHOURSINST(S,T)*(CARD(S)/CARD(SSS))*(1/CYCLES(T))))
;

QSTORAGEBALANCE_Y(IY411,IA,PROCSTORAGE_Y,FLOW,S)$((SUM(IPROCFROM$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE_Y,FLOW),1))
                                             AND IPROCINOUTFLOW(IY411,IA,PROCSTORAGE_Y,FLOW,FLOW))..

VSTORAGEVOL_Y(IY411,IA,PROCSTORAGE_Y,FLOW,S++1)
=E=
VSTORAGEVOL_Y(IY411,IA,PROCSTORAGE_Y,FLOW,S)

* Entering Flow (indexed over time segments (S,ITWWT)):
 +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE_Y,FLOW) AND (NOT PROC_T(IPROCFROM))),
  SUM(ITWWT,VFLOW(IY411,IA,IPROCFROM,PROCSTORAGE_Y,FLOW,S,ITWWT)*PROCINOUTFLOW(IY411,IA,PROCSTORAGE_Y,FLOW,FLOW,'IONEONE')*IHOURSINSTWWT(S,ITWWT)))
* Entering Flow (indexed over time segments (S,T)):
 +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE_Y,FLOW) AND (PROC_T(IPROCFROM))),
  SUM(T,VFLOW(IY411,IA,IPROCFROM,PROCSTORAGE_Y,FLOW,S,T)*PROCINOUTFLOW(IY411,IA,PROCSTORAGE_Y,FLOW,FLOW,'IONEONE')*IHOURSINST(S,T)))

* Leaving FLOW (indexed over time segments (S,ITWWT)):
-SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROCSTORAGE_Y,IPROCTO,FLOW) AND (NOT PROC_T(IPROCTO))), SUM(ITWWT,VFLOW(IY411,IA,PROCSTORAGE_Y,IPROCTO,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))
* Leaving FLOW (indexed over time segments (S,T)):
-SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROCSTORAGE_Y,IPROCTO,FLOW) AND (PROC_T(IPROCTO))),SUM(T,VFLOW(IY411,IA,PROCSTORAGE_Y,IPROCTO,FLOW,S,T)*IHOURSINST(S,T)))
;

QSTORAGEBALANCE_YT(IY411,IA,PROCSTORAGE_YT,FLOW,S,T)$((SUM(IPROCFROM$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE_YT,FLOW),1))
                                             AND IPROCINOUTFLOW(IY411,IA,PROCSTORAGE_YT,FLOW,FLOW))..



VSTORAGEVOL_ST(IY411,IA,PROCSTORAGE_YT,FLOW,S,T+1)+SUM(ITALIAS$(ORD(ITALIAS) EQ 1),VSTORAGEVOL_ST(IY411,IA,PROCSTORAGE_YT,FLOW,S++1,ITALIAS)$(ORD(T) EQ CARD(T)))
=E=
VSTORAGEVOL_ST(IY411,IA,PROCSTORAGE_YT,FLOW,S,T)

* Entering Flow (indexed over time segments (S,T)):
 +SUM(IPROCFROM$FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROCSTORAGE_YT,FLOW),
  VFLOW(IY411,IA,IPROCFROM,PROCSTORAGE_YT,FLOW,S,T)*PROCINOUTFLOW(IY411,IA,PROCSTORAGE_YT,FLOW,FLOW,'IONEONE')*(IHOURSINST(S,T)*(CARD(S)/CARD(SSS))*(1/CYCLES(T))))

* Leaving FLOW (indexed over time segments (S,T)):
-SUM(IPROCTO$FLOWFROMTOPROC(IY411,IA,PROCSTORAGE_YT,IPROCTO,FLOW),
 VFLOW(IY411,IA,PROCSTORAGE_YT,IPROCTO,FLOW,S,T)*(IHOURSINST(S,T)*(CARD(S)/CARD(SSS))*(1/CYCLES(T))))
;



* TODO: apparently this assumes that PROCEXIM is not in PROC_T!   Is this OK?
QTRANSITNODEBALANCE(IY411,AAATRANSIT,PROCEXIM,IFLOWEXIM,S,ITWWT)..
 SUM(IAE$ITRANSFLOWFROMTO(IAE,AAATRANSIT,IFLOWEXIM), VFLOWTRANS(IY411,IAE,AAATRANSIT,PROCEXIM,IFLOWEXIM,S,ITWWT)$(NOT TRANSFLOWMAX(IAE,AAATRANSIT,PROCEXIM,IFLOWEXIM)))
 =E=
 SUM(IAI$ITRANSFLOWFROMTO(AAATRANSIT,IAI,IFLOWEXIM), VFLOWTRANS(IY411,AAATRANSIT,IAI,PROCEXIM,IFLOWEXIM,S,ITWWT)$(NOT TRANSFLOWMAX(AAATRANSIT,IAI,PROCEXIM,IFLOWEXIM)) )
;

**This equation should be written in a better way, but at least it works :(   Amalia (2015-06-23)


QFLOWSHAREOUT2OUTLO(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,S,T)$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)             AND
                                                                        IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2)              AND
                                                                        PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")     AND
                                                                        PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2,"IONEMANY")    AND
                                                                        FLOWSHAREOUT2OUT(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,'ILOUPFX_LO')
                                                                        AND IPROCTIMESETS(PROC,T))..

 SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")),
   VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T))
 =L=
 SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT2) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2,"IONEMANY")),
   VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT2,S,T)) * FLOWSHAREOUT2OUT(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,'ILOUPFX_LO')
;

QFLOWSHAREOUT2OUTUP(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,S,T)$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)             AND
                                                                        IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2)              AND
                                                                        PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")     AND
                                                                        PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2,"IONEMANY")    AND
                                                                        FLOWSHAREOUT2OUT(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,'ILOUPFX_UP')
                                                                        AND IPROCTIMESETS(PROC,T))..

SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")),
   VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T))
 =G=
 SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT2) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2,"IONEMANY")),
   VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT2,S,T)) * FLOWSHAREOUT2OUT(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,'ILOUPFX_UP')
;

QFLOWSHAREOUT2OUTFX(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,S,T)$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)             AND
                                                                        IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2)              AND
                                                                        PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")     AND
                                                                        PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2,"IONEMANY")    AND
                                                                        FLOWSHAREOUT2OUT(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,'ILOUPFX_FX')
                                                                        AND IPROCTIMESETS(PROC,T))..

SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")),
   VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T))
 =E=
 SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT2) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT2,"IONEMANY")),
   VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT2,S,T)) * FLOWSHAREOUT2OUT(IY411,IA,PROC,IFLOWIN,IFLOWOUT,IFLOWOUT2,'ILOUPFX_FX')
;



QFLOWSHAREOUT2INLO(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T)$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT)              AND
                                                          PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")    AND
                                                          SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_LO')),1)   !! Note: the part in /**/ is not needed, appears above; cf. also two eqns below
                                                          AND IPROCTIMESETS(PROC,T))..

* Left hand side FLOW: a split outFLOW that is coming from a single inFLOW:
 +SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_LO')), VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T))
 =G=
* Right hand side FLOW: the single inFLOW that is split on two out more outFLOW with IONEMANY:
  +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) ), VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)
   * (SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_LO')),FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_LO'))))

$ifi %useShareSlack%==yes  - VQFLOWSHAREOUT2INLO(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T,'ILOUPFX_LO','IPLUS')

;


QFLOWSHAREOUT2INUP(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T)$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND
   SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_UP')),1)
                                         AND IPROCTIMESETS(PROC,T))..

* Left hand side FLOW: a split outFLOW that is coming from a single inFLOW:
 +SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_UP')), VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T))
 =L=
* Right hand side FLOW: the single inFLOW that is split on two out more outFLOW with IONEMANY:
  +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) ), VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)
   * (SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_UP')),FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_UP'))))

$ifi %useShareSlack%==yes  + VQFLOWSHAREOUT2INUP(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T,'ILOUPFX_UP','IMINUS')
;

QFLOWSHAREOUT2INFX(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T)$(IPROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND
   SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_FX')),1)
                                         AND IPROCTIMESETS(PROC,T))..

* Left hand side FLOW: a split outFLOW that is coming from a single inFLOW:
 +SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_FX')), VFLOW(IY411,IA,PROC,IPROCTO,IFLOWOUT,S,T))
 =E=
* Right hand side FLOW: the single inFLOW that is split on two out more outFLOW with IONEMANY:
  +SUM(IPROCFROM$(FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) ), VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)
   * (SUM(IPROCTO$(FLOWFROMTOPROC(IY411,IA,PROC,IPROCTO,IFLOWOUT) AND PROCINOUTFLOW(IY411,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY") AND FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_FX')),FLOWSHAREOUT2IN(IY411,IA,PROC,IPROCTO,IFLOWOUT,'ILOUPFX_FX'))))

$ifi %useShareSlack%==yes  + VQFLOWSHAREOUT2INFX(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,T,'ILOUPFX_FX','IMINUS')
$ifi %useShareSlack%==yes  - VQFLOWSHAREOUT2INFX(IY411,IA,PROC,IFLOWIN,IFLOWOUT,S,ITW,'ILOUPFX_FX','IPLUS')
;

QFLOWSHAREIN2INLO(IY411,IA,IPROCFROM,IPROCFROM2,PROC,IFLOWIN,IFLOWIN2,S,T)$(
                                          FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) AND FLOWFROMTOPROC(IY411,IA,IPROCFROM2,PROC,IFLOWIN2)
                                          AND FLOWSHAREIN2IN(IY411,IA,PROC,IFLOWIN,IFLOWIN2,'ILOUPFX_LO')
                                          AND IPROCTIMESETS(PROC,T))..

VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)
 =G=
VFLOW(IY411,IA,IPROCFROM2,PROC,IFLOWIN2,S,T)*FLOWSHAREIN2IN(IY411,IA,PROC,IFLOWIN,IFLOWIN2,'ILOUPFX_LO');

QFLOWSHAREIN2INFX(IY411,IA,IPROCFROM,IPROCFROM2,PROC,IFLOWIN,IFLOWIN2,S,T)$(
                                          FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) AND FLOWFROMTOPROC(IY411,IA,IPROCFROM2,PROC,IFLOWIN2)
                                          AND FLOWSHAREIN2IN(IY411,IA,PROC,IFLOWIN,IFLOWIN2,'ILOUPFX_FX')
                                          AND IPROCTIMESETS(PROC,T))..

VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)
 =E=
VFLOW(IY411,IA,IPROCFROM2,PROC,IFLOWIN2,S,T)*FLOWSHAREIN2IN(IY411,IA,PROC,IFLOWIN,IFLOWIN2,'ILOUPFX_FX');

QFLOWSHAREIN2INUP(IY411,IA,IPROCFROM,IPROCFROM2,PROC,IFLOWIN,IFLOWIN2,S,T)$(
                                          FLOWFROMTOPROC(IY411,IA,IPROCFROM,PROC,IFLOWIN) AND FLOWFROMTOPROC(IY411,IA,IPROCFROM2,PROC,IFLOWIN2)
                                          AND FLOWSHAREIN2IN(IY411,IA,PROC,IFLOWIN,IFLOWIN2,'ILOUPFX_UP')
                                          AND IPROCTIMESETS(PROC,T))..

VFLOW(IY411,IA,IPROCFROM,PROC,IFLOWIN,S,T)
 =L=
VFLOW(IY411,IA,IPROCFROM2,PROC,IFLOWIN2,S,T)*FLOWSHAREIN2IN(IY411,IA,PROC,IFLOWIN,IFLOWIN2,'ILOUPFX_UP');



QINDICINDICMIN(IY411,FLOWINDIC)$(INDICLIMGOAL(FLOWINDIC,"INDICMIN") AND (INDICLIMGOAL(FLOWINDIC,"INDICMIN") GT -INF))..
  INDICLIMGOAL(FLOWINDIC,"INDICMIN") =L= VFLOWINDICVALUES(IY411,FLOWINDIC);

QINDICINDICMAX(IY411,FLOWINDIC)$(INDICLIMGOAL(FLOWINDIC,"INDICMAX") AND (INDICLIMGOAL(FLOWINDIC,"INDICMAX") LT +INF))..
  VFLOWINDICVALUES(IY411,FLOWINDIC) =L= INDICLIMGOAL(FLOWINDIC,"INDICMAX");

*-------------------------------------
* Process capacity investments
*-------------------------------------

* This equation accumulates investments into process capacity
QPROCKAPACCUMNET(IY411,IA,IPROC)$SUM(Y$(YVALUE(Y) LE YVALUE(IY411)),IAPROCKAPNEW(Y,IA,IPROC))
  ..
  VPROCKAPACCUMNET(IY411,IA,IPROC)
    =E=
  SUM(IY402$IY411PREVY(IY411,IY402), VPROCKAPACCUMNET(IY402,IA,IPROC)$SUM(Y$(YVALUE(Y) LT YVALUE(IY411)),IAPROCKAPNEW(Y,IA,IPROC)))$(NOT IYFIRST(IY411))
  + VPROCKAPNEW(IY411,IA,IPROC)$IAPROCKAPNEW(IY411,IA,IPROC)
;


*This equation is for any process that is not a storage process, so IPROCFROM (when is in IFLOWINOUT_OUT or IPROCTO (when is IFLOWIN_IN) cannot be a PROCSTORAGE
*If we want to highlight the importance of storage, we should take them into account and write them

QPROCKAP_UP(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)$(
(
*(NOT PROCSTORAGE(IPROCFROM)) AND (NOT PROCSTORAGE_Y(IPROCFROM)) AND
  (FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND (IPROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))))
   OR (
*(NOT PROCSTORAGE(IPROCTO)) AND (NOT PROCSTORAGE_Y(IPROCTO)) AND
  (FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND (IPROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))))
    )..
  VFLOW(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)
    =L=
   PROCKAPFX(IY411,IA,IPROCFROM,FLOW,'IFLOWINOUT_OUT')$(PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))
 + PROCKAPFX(IY411,IA,IPROCTO,FLOW,'IFLOWINOUT_IN')$(PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))
 + VPROCKAPACCUMNET(IY411,IA,IPROCFROM)$(SUM(Y$(YVALUE(Y) LE YVALUE(IY411)),IAPROCKAPNEW(Y,IA,IPROCFROM)) AND (IPROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT')))
 + VPROCKAPACCUMNET(IY411,IA,IPROCTO)$(SUM(Y$(YVALUE(Y) LE YVALUE(IY411)),IAPROCKAPNEW(Y,IA,IPROCTO)) AND (IPROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN')))
;

*FLOWFROMTOPROC(IY411,IA,IPROCFROM2,IPROCTO,FLOW) AND 

QPROCKAUP_SCALE1(IY411,IA,PROC)$(IAPROCKAPNEW(IY411,IA,PROC) AND PROCKAPNEWSCALE(PROC))..
   VPROCKAPNEW(IY411,IA,PROC)=G=PROCKAPNEWSCALE(PROC)*VPROCKAPNEWSCALE_U(IY411,IA,PROC);

QPROCKAUP_SCALE2(IY411,IA,PROC)$(IAPROCKAPNEW(IY411,IA,PROC) AND PROCKAPNEWSCALE(PROC))..
   VPROCKAPNEW(IY411,IA,PROC)=L=VPROCKAPNEWSCALE_U(IY411,IA,PROC)*M_EconomyScale;

QPROCKAP_DEC(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)$(((FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND PROCKAPDECOM(IPROCFROM) AND
        ((IAPROCKAPNEW(IY411,IA,IPROCFROM) OR PROCKAPFX(IY411,IA,IPROCFROM,FLOW,'IFLOWINOUT_OUT')) AND PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))))
   OR ((FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND PROCKAPDECOM(IPROCTO) AND
        ((IAPROCKAPNEW(IY411,IA,IPROCTO) OR PROCKAPFX(IY411,IA,IPROCTO,FLOW,'IFLOWINOUT_IN')) AND PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))))
    )..
  VFLOW(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)    =L=
   (PROCKAPFX(IY411,IA,IPROCFROM,FLOW,'IFLOWINOUT_OUT')*VPROCKAPDEC_U(IY411,IA,IPROCFROM))$(PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))
   +(PROCKAPFX(IY411,IA,IPROCTO,FLOW,'IFLOWINOUT_IN')*VPROCKAPDEC_U(IY411,IA,IPROCTO))$(PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))

;

QRAMPUPPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)$((((FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND PROCRAMPUP(IPROCFROM) AND
        ((IAPROCKAPNEW(IY411,IA,IPROCFROM) OR PROCKAPFX(IY411,IA,IPROCFROM,FLOW,'IFLOWINOUT_OUT')) AND PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))))
   OR ((FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND PROCRAMPUP(IPROCTO) AND
        ((IAPROCKAPNEW(IY411,IA,IPROCTO) OR PROCKAPFX(IY411,IA,IPROCTO,FLOW,'IFLOWINOUT_IN')) AND PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN')))))
   AND (NOT (ORD(T) EQ CARD(T)))
      )..
VFLOW(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T+1)-VFLOW(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)=L=
  (PROCRAMPDOWN(IPROCFROM)*TIMELENGHT(T)*(
                 (VPROCKAPNEW(IY411,IA,IPROCFROM)$(IAPROCKAPNEW(IY411,IA,IPROCFROM) AND PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))
                 +PROCKAPFX(IY411,IA,IPROCFROM,FLOW,'IFLOWINOUT_OUT')$PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))))
+  (PROCRAMPDOWN(IPROCTO)*TIMELENGHT(T)*(
                 (VPROCKAPNEW(IY411,IA,IPROCTO)$(IAPROCKAPNEW(IY411,IA,IPROCTO) AND PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))
                 +PROCKAPFX(IY411,IA,IPROCTO,FLOW,'IFLOWINOUT_IN')$PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))))
;

QRAMPDOWNPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)$((((FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND PROCRAMPDOWN(IPROCFROM) AND
        ((IAPROCKAPNEW(IY411,IA,IPROCFROM) OR PROCKAPFX(IY411,IA,IPROCFROM,FLOW,'IFLOWINOUT_OUT')) AND PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))))
   OR ((FLOWFROMTOPROC(IY411,IA,IPROCFROM,IPROCTO,FLOW) AND PROCRAMPDOWN(IPROCTO) AND
        ((IAPROCKAPNEW(IY411,IA,IPROCTO) OR PROCKAPFX(IY411,IA,IPROCTO,FLOW,'IFLOWINOUT_IN')) AND PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN')))))
   AND (NOT (ORD(T) EQ CARD(T)))
      )..
VFLOW(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T)-VFLOW(IY411,IA,IPROCFROM,IPROCTO,FLOW,S,T+1)=L=
  (PROCRAMPDOWN(IPROCFROM)*TIMELENGHT(T)*(
                 (VPROCKAPNEW(IY411,IA,IPROCFROM)$(IAPROCKAPNEW(IY411,IA,IPROCFROM) AND PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))
                 +PROCKAPFX(IY411,IA,IPROCFROM,FLOW,'IFLOWINOUT_OUT')$PROCKAPDATA(IY411,IPROCFROM,FLOW,'IFLOWINOUT_OUT'))))
+  (PROCRAMPDOWN(IPROCTO)*TIMELENGHT(T)*(
                 (VPROCKAPNEW(IY411,IA,IPROCTO)$(IAPROCKAPNEW(IY411,IA,IPROCTO) AND PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))
                 +PROCKAPFX(IY411,IA,IPROCTO,FLOW,'IFLOWINOUT_IN')$PROCKAPDATA(IY411,IPROCTO,FLOW,'IFLOWINOUT_IN'))))
;




*Amalia - Equation for investment in storage technologies was missing. With the following equation is included

QSTOVOLTLIM_T(IY411,IA,PROCSTORAGE,FLOW,S,T)$((IAPROCKAPNEW(IY411,IA,PROCSTORAGE) AND PROCKAPDATA(IY411,PROCSTORAGE,FLOW,'IFLOWINOUT_IN')))..

   VSTORAGEVOL(IY411,IA,PROCSTORAGE,FLOW,S,T)=L=

   PROCSTORAGEBOUND(IY411,IA,PROCSTORAGE)$(PROCKAPDATA(IY411,PROCSTORAGE,FLOW,'IFLOWINOUT_IN'))

*  + SUM(IY402$IY411PREVY(IY411,IY402),VPROCKAPACCUMNET(IY402,IA,PROCSTORAGE))                     !! CHECK
  + VPROCKAPNEW(IY411,IA,PROCSTORAGE)$((IAPROCKAPNEW(IY411,IA,PROCSTORAGE) AND PROCKAPDATA(IY411,PROCSTORAGE,FLOW,'IFLOWINOUT_IN')))
;


QSTOVOLTLIM(IY411,IA,PROCSTORAGE_Y,FLOW,S)$((IAPROCKAPNEW(IY411,IA,PROCSTORAGE_Y) AND PROCKAPDATA(IY411,PROCSTORAGE_Y,FLOW,'IFLOWINOUT_IN')))..

   VSTORAGEVOL_Y(IY411,IA,PROCSTORAGE_Y,FLOW,S)=L=

   PROCSTORAGEBOUND(IY411,IA,PROCSTORAGE_Y)$PROCKAPDATA(IY411,PROCSTORAGE_Y,FLOW,'IFLOWINOUT_IN')

*  + SUM(IY402$IY411PREVY(IY411,IY402),VPROCKAPACCUMNET(IY402,IA,PROCSTORAGE_Y))                     !! CHECK
  + VPROCKAPNEW(IY411,IA,PROCSTORAGE_Y)$((IAPROCKAPNEW(IY411,IA,PROCSTORAGE_Y) AND PROCKAPDATA(IY411,PROCSTORAGE_Y,FLOW,'IFLOWINOUT_IN')))
;




















*Equation for fuel constraints at an annual level

QEQFLOW_A(IY411,IA,PROC,FLOW)$((IENTERPROC(IY411,IA,PROC,FLOW) OR ILEAVEPROC(IY411,IA,PROC,FLOW)) AND EQFLOW(IY411,IA,PROC,FLOW))..
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC)AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC)AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
            =E=EQFLOW(IY411,IA,PROC,FLOW);


QEQFLOW_R(IY411,IR,PROC,FLOW)$(((SUM(IA$RRRAAA(IR,IA),IENTERPROC(IY411,IA,PROC,FLOW))) OR (SUM(IA$RRRAAA(IR,IA),ILEAVEPROC(IY411,IA,PROC,FLOW)))) AND EQFLOW(IY411,IR,PROC,FLOW))..
SUM(IA$RRRAAA(IR,IA),
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC)AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC)AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
    )
            =E=EQFLOW(IY411,IR,PROC,FLOW);


QEQFLOW_C(IY411,C,PROC,FLOW)$(((SUM(IA$ICA(C,IA),IENTERPROC(IY411,IA,PROC,FLOW))) OR (SUM(IA$ICA(C,IA),ILEAVEPROC(IY411,IA,PROC,FLOW)))) AND EQFLOW(IY411,C,PROC,FLOW))..
SUM(IA$ICA(C,IA),
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
    )
            =E=EQFLOW(IY411,C,PROC,FLOW);


QMAXFLOW_A(IY411,IA,PROC,FLOW)$((IENTERPROC(IY411,IA,PROC,FLOW) OR ILEAVEPROC(IY411,IA,PROC,FLOW)) AND MAXFLOW(IY411,IA,PROC,FLOW))..
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)) ,VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
            =L=MAXFLOW(IY411,IA,PROC,FLOW);


QMAXFLOW_R(IY411,IR,PROC,FLOW)$(((SUM(IA$RRRAAA(IR,IA),IENTERPROC(IY411,IA,PROC,FLOW))) OR (SUM(IA$RRRAAA(IR,IA),ILEAVEPROC(IY411,IA,PROC,FLOW)))) AND MAXFLOW(IY411,IR,PROC,FLOW))..
SUM(IA$RRRAAA(IR,IA),
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
    )
            =L=MAXFLOW(IY411,IR,PROC,FLOW);


QMAXFLOW_C(IY411,C,PROC,FLOW)$(((SUM(IA$ICA(C,IA),IENTERPROC(IY411,IA,PROC,FLOW))) OR (SUM(IA$ICA(C,IA),ILEAVEPROC(IY411,IA,PROC,FLOW)))) AND MAXFLOW(IY411,C,PROC,FLOW))..
SUM(IA$ICA(C,IA),
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
   )
            =L=MAXFLOW(IY411,C,PROC,FLOW);


QMINFLOW_A(IY411,IA,PROC,FLOW)$((IENTERPROC(IY411,IA,PROC,FLOW) OR ILEAVEPROC(IY411,IA,PROC,FLOW)) AND MINFLOW(IY411,IA,PROC,FLOW))..
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
            =G=MINFLOW(IY411,IA,PROC,FLOW);


QMINFLOW_R(IY411,IR,PROC,FLOW)$(((SUM(IA$RRRAAA(IR,IA),IENTERPROC(IY411,IA,PROC,FLOW))) OR (SUM(IA$RRRAAA(IR,IA),ILEAVEPROC(IY411,IA,PROC,FLOW)))) AND MINFLOW(IY411,IR,PROC,FLOW))..
SUM(IA$RRRAAA(IR,IA),
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
    )
            =G=MINFLOW(IY411,IR,PROC,FLOW);


QMINFLOW_C(IY411,C,PROC,FLOW)$(((SUM(IA$ICA(C,IA),IENTERPROC(IY411,IA,PROC,FLOW))) OR (SUM(IA$ICA(C,IA),ILEAVEPROC(IY411,IA,PROC,FLOW)))) AND MINFLOW(IY411,C,PROC,FLOW))..
SUM(IA$ICA(C,IA),
   (SUM((PROCBUFFER,S,T)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCBUFFER,S,ITWWT)$(PROCBUFFER(PROC) AND (IENTERPROC(IY411,IA,PROCBUFFER,FLOW) OR ILEAVEPROC(IY411,IA,PROCBUFFER,FLOW))),VFLOWBUFFER(IY411,IA,PROCBUFFER,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSOURCE,S,T)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSOURCE,S,ITWWT)$(PROCSOURCE(PROC) AND ILEAVEPROC(IY411,IA,PROCSOURCE,FLOW)),VFLOWSOURCE(IY411,IA,PROCSOURCE,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))+
   (SUM((PROCSINK,S,T)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,T)*IHOURSINST(S,T)))$(PROC_T(PROC))+
   (SUM((PROCSINK,S,ITWWT)$(PROCSINK(PROC) AND IENTERPROC(IY411,IA,PROCSINK,FLOW)),VFLOWSINK(IY411,IA,PROCSINK,FLOW,S,ITWWT)*IHOURSINSTWWT(S,ITWWT)))$((NOT PROC_T(PROC)))
   )
            =G=MINFLOW(IY411,C,PROC,FLOW);