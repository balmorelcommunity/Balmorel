
*---ORIGINAL
+SUM((FLOWINDIC),VFLOWINDICVALUES(Y,FLOWINDIC)*INDICLIMGOAL(FLOWINDIC,'INDICWEIGHT')




* Investment costs  !! TODO: shall it be here, or e.g.  in   VFLOWINDICVALUES  , or in ..
* First here, year one cost of investment
    + IOF1000000*(SUM((IA,PROC)$IAPROCKAPNEW(Y,IA,PROC),
      PROCDATA(PROC,'PROCINVCOST')*INDICLIMGOAL(FLOWINDIC,'INDICWEIGHT')*VPROCKAPNEW(Y,IA,PROC)*(SUM(C$ICA(C,IA),ANNUITYCPROC(C,PROC)))*SUM(IYALIAS2$(ORD(IYALIAS2) EQ ORD(Y)),IYHASANNUITYPROC(Y,IYALIAS2,PROC))))
* Second, cost of previous year investments
    + IOF1000000*(SUM((IYALIAS2,IA,PROC)$(IAPROCKAPNEW(IYALIAS2,IA,PROC) AND (ORD(IYALIAS2) LT ORD(Y))),
      PROCDATA(PROC,'PROCINVCOST')*INDICLIMGOAL(FLOWINDIC,'INDICWEIGHT')*VPROCKAPNEW(IYALIAS2,IA,PROC)*(SUM(C$ICA(C,IA),ANNUITYCPROC(C,PROC)))*IYHASANNUITYPROC(IYALIAS2,Y,PROC)))
* all investments fixed cost, TMAD
    + SUM((IA,PROC,FLOW,IFLOWINOUT)$(IPROCKAPDATA(Y,PROC,FLOW,IFLOWINOUT) AND (IAPROCKAPNEW_notY(IA,PROC) OR PROCKAPFX(Y,IA,PROC,FLOW,IFLOWINOUT))),
      PROCDATA(PROC,'PROCFIXCOST')*INDICLIMGOAL(FLOWINDIC,'INDICWEIGHT')*
      (VPROCKAPACCUMNET(Y,IA,PROC)$(IAPROCKAPNEW_notY(IA,PROC))+PROCKAPFX(Y,IA,PROC,FLOW,IFLOWINOUT)$(NOT PROCKAPDECOM(PROC))+PROCKAPFX(Y,IA,PROC,FLOW,IFLOWINOUT)*VPROCKAPDEC_U(Y,IA,PROC)$(PROCKAPDECOM(PROC)))))


* If Balmorel Carbon Capture is used in a fuel, then remove the transport cost again paid for in the CCS addon.
$ifi %baloptCCU%==yes $ifi %CCS%==yes - SUM(IA, SUM((IS3,T), SUM((PROCSOURCE,FLOW)$(ICO2(PROCSOURCE,FLOW)),IHOURSINST(IS3,T) * VFLOWSOURCE(Y,IA,PROCSOURCE,FLOW,IS3,T))) *CCS_TRANSPORTCOST )



$ontext

    + SUM((IA,PROC)$IAPROCKAPNEW(Y,IA,PROC),
      IOF1000000*PROCDATA(PROC,'PROCINVCOST')*VPROCKAPNEW(Y,IA,PROC))
    + SUM((IA,PROC,FLOW,IFLOWINOUT)$(PROCKAPDATA(Y,PROC,FLOW,IFLOWINOUT) AND (IAPROCKAPNEW(Y,IA,PROC) OR PROCKAPFX(Y,IA,PROC,FLOW,IFLOWINOUT))),
      PROCDATA(PROC,'PROCFIXCOST')*
      (VPROCKAPNEW(Y,IA,PROC)$(IAPROCKAPNEW(Y,IA,PROC))+PROCKAPFX(Y,IA,PROC,FLOW,IFLOWINOUT)$(NOT PROCKAPDECOM(PROC))+PROCKAPFX(Y,IA,PROC,FLOW,IFLOWINOUT)*VPROCKAPDEC_U(Y,IA,PROC)$(PROCKAPDECOM(PROC)))))


$offtext



* Addon for discrete zise investments
$ifi %APKNdisc%==yes $include "..\addons\OptiFlow\apkndisc\apkndiscaddqobj.inc";

$ifi %useQNODEslack%==yes  -SUM((IA,PROC,IFLOWIN,IFLOWOUT,IPLUSMINUS)$(IPROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT) AND (IPRIOVARIOUTSUM(Y,IA,PROC,IFLOWIN,IFLOWOUT) LE 1) AND (IPRIOVARIINSUM(Y,IA,PROC,IFLOWIN,IFLOWOUT) LE 1)  AND  (NOT PROCSTORAGE(PROC)) AND  (NOT PROCSTORAGE_Y(PROC))),  !! directly as QNODEBALNCE
$ifi %useQNODEslack%==yes   (SUM((IS3,T),IPENALTYQ*VQNODEBALANCE(IA,PROC,IFLOWIN,IFLOWOUT,IS3,T,IPLUSMINUS))))

$ifi %useSSBslack%==yes -(IPENALTYQ*SUM((IA,PROCSOURCE,FLOW,IPLUSMINUS)$(SUM(ILOUPFXSET$SOSIBUBOUND(IY411,IA,PROCSOURCE,FLOW,ILOUPFXSET),1)), SUM((IS3,T), VQSOURCEBALANCE(IA,PROCSOURCE,FLOW,IS3,T,IPLUSMINUS))))     !! $(SUM(ILOUPFXSET$SOSIBUBOUND(IY411,IA,PROCSOURCE,FLOW,ILOUPFXSET),1)) is for limitation only
$ifi %useSSBslack%==yes -(IPENALTYQ*SUM((IA,PROCSINK,FLOW,IPLUSMINUS)$(SUM(ILOUPFXSET$SOSIBUBOUND(IY411,IA,PROCSINK,FLOW,ILOUPFXSET),1)),     SUM((IS3,T), VQSINKBALANCE(IA,PROCSINK,FLOW,IS3,T,IPLUSMINUS))))
$ifi %useSSBslack%==yes -(IPENALTYQ*SUM((IA,PROCBUFFER,FLOW,IPLUSMINUS)$(SUM(ILOUPFXSET$SOSIBUBOUND(IY411,IA,PROCBUFFER,FLOW,ILOUPFXSET),1)), SUM((IS3,T), VQBUFFERBALANCE(IA,PROCBUFFER,FLOW,IS3,T,IPLUSMINUS))))

$ifi %useShareSlack%==yes -(IPENALTYQ*SUM((IA,PROC,IFLOWIN,IFLOWOUT,S,ITWWT,ILOUPFXSET,IPLUSMINUS)$(IPROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT) AND PROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")), VQFLOWSHAREOUT2INLO(IA,PROC,IFLOWIN,IFLOWOUT,S,ITWWT,'ILOUPFX_LO','IPLUS') ))
$ifi %useShareSlack%==yes -(IPENALTYQ*SUM((IA,PROC,IFLOWIN,IFLOWOUT,S,ITWWT,ILOUPFXSET,IPLUSMINUS)$(IPROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT) AND PROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")), VQFLOWSHAREOUT2INUP(IA,PROC,IFLOWIN,IFLOWOUT,S,ITWWT,'ILOUPFX_UP','IMINUS')))
$ifi %useShareSlack%==yes -(IPENALTYQ*SUM((IA,PROC,IFLOWIN,IFLOWOUT,S,ITWWT,ILOUPFXSET,IPLUSMINUS)$(IPROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT) AND PROCINOUTFLOW(Y,IA,PROC,IFLOWIN,IFLOWOUT,"IONEMANY")), (VQFLOWSHAREOUT2INFX(IA,PROC,IFLOWIN,IFLOWOUT,S,ITWWT,'ILOUPFX_FX','IMINUS') + VQFLOWSHAREOUT2INFX(IA,PROC,IFLOWIN,IFLOWOUT,S,ITWWT,'ILOUPFX_FX','IPLUS'))))

$ifi %uniquesol%==yes  +1E-4*(
$ifi %uniquesol%==yes -SUM((IA,IPROCFROM,IPROCTO,FLOW,S,T)$FLOWFROMTOPROC(Y,IA,IPROCFROM,IPROCTO,FLOW),VFLOW(IA,IPROCFROM,IPROCTO,FLOW,S,T)*VFLOW(IA,IPROCFROM,IPROCTO,FLOW,S,T))
$ifi %uniquesol%==yes -SUM((IA,PROCSOURCE,FLOW,S,T),VFLOWSOURCE(IA,PROCSOURCE,FLOW,S,T)*VFLOWSOURCE(IA,PROCSOURCE,FLOW,S,T))
$ifi %uniquesol%==yes -SUM((IA,PROCSINK,FLOW,S,T),VFLOWSINK(IA,PROCSINK,FLOW,S,T)*VFLOWSINK(IA,PROCSINK,FLOW,S,T))
$ifi %uniquesol%==yes -SUM((IA,PROCBUFFER,FLOW,S,T),VFLOWBUFFER(IA,PROCBUFFER,FLOW,S,T)*VFLOWBUFFER(IA,PROCBUFFER,FLOW,S,T))
$ifi %uniquesol%==yes -SUM((IAE,IAI,FLOW,S,T)$TRANSDIST(PROC,IAE,IAI),VFLOWTRANS(IAE,IAI,FLOW,S,T)*VFLOWTRANS(IAE,IAI,FLOW,S,T))
$ifi %uniquesol%==yes  )

