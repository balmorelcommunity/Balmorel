$ifi not %DUMB%==yes $goto DUMB_END
$ifi not %DEGCYCLE%==yes $goto DEGCYCLE_END2

+ (SUM((S,T,IR)$(EV_BEV_Max(Y,S,T,IR) > 0 AND IS3(S)),((EV_BEV_Dumb(Y,S,T,IR)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0
+ (SUM((S,T,IR)$(EV_PHEV_Max(Y,S,T,IR) > 0 AND IS3(S)),((EV_PHEV_Dumb(Y,S,T,IR)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0

$label  DEGCYCLE_END2


$ifi not %DEGCAL%==yes $goto DEGCAL_END2
+ (SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(EV_BEV_SOCDumb(Y,S,T,IR)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_BEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0
+ (SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(EV_PHEV_SOCDumb(Y,S,T,IR)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_PHEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0


$label  DEGCAL_END2
$label  DUMB_END




$ifi not %SMART%==yes $goto SMART_END
$ifi not %DEGCYCLE%==yes $goto DEGCYCLE_END

+ (SUM((S,T,IR)$(EV_BEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0
+ (SUM((S,T,IR)$(EV_PHEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0

$label  DEGCYCLE_END

$ifi not %DEGCAL%==yes $goto DEGCAL_END

+ (SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_BEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0
+ (SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_PHEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0

$label  DEGCAL_END
$label  SMART_END




$ifi not %V2G%==yes $goto V2G_END
$ifi not %DEGCYCLE%==yes $goto V2GDEGCYCLE_END

+( SUM((S,T,IR)$(EV_BEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0
+( SUM((S,T,IR)$(EV_PHEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0


$label  V2GDEGCYCLE_END

$ifi not %DEGCAL%==yes $goto V2GDEGCAL_END

+( SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_BEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0
+( SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_PHEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0


$label  V2GDEGCAL_END
+( SUM((S,T,IR)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND IS3(S)),EV_CHARGERCOST(Y) * EV_BEV_Avail(Y,S,T,IR)) )$(Y.val>2019)+0
*+ SUM((S,T,IR)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND IS3(S)),EV_CHARGERCOST(Y) * EV_PHEV_Avail(Y,S,T,IR))

$label  V2G_END







$ifi not %STEPCHARGSCHEME%==yes $goto STEPCHARGSCHEME_END
$ifi not %DEGCYCLE%==yes $goto DEGCYCLE_END3

+ ((SUM((S,T,IR)$(EV_BEV_Max(Y,S,T,IR) > 0 AND IS3(S)),((EV_BEV_Dumb(Y,S,T,IR)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y))))
+ SUM((S,T,IR)$(EV_PHEV_Max(Y,S,T,IR) > 0 AND IS3(S)),((EV_PHEV_Dumb(Y,S,T,IR)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019))$cs('dumb',Y)

+ ((SUM((S,T,IR)$(EV_BEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0
+ (SUM((S,T,IR)$(EV_PHEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019)+0)$cs('smart',Y)

+ ((SUM((S,T,IR)$(EV_BEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y))))
+ SUM((S,T,IR)$(EV_PHEV_Max(Y,S,T,IR) > 0 AND IS3(S)),(((VEV_VG2V_BEV(Y,IR,S,T)+EV_BEV_Inflex(Y,S,T,IR))/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*EV_BATTDEGCYCLE(Y)*EV_BATTCOST(Y)*(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y)/(EV_LIFEFACTOR(Y)))))$(Y.val>2019))$cs('v2g',Y)



$label  DEGCYCLE_END3


$ifi not %DEGCAL%==yes $goto DEGCAL_END3
+ ((SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(EV_BEV_SOCDumb(Y,S,T,IR)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_BEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y)))
+ SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(EV_PHEV_SOCDumb(Y,S,T,IR)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_PHEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019))$cs('dumb',Y)

+ ((SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_BEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0
+ (SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_PHEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019)+0)$cs('smart',Y)

+ ((SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_BEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_BEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y)))
+ SUM((S,T,IR)$IS3(S),(EV_BATTDEGCALCONST(Y)+EV_BATTDEGCALFLEX(Y)*(VEV_VSOC_BEV(Y,IR,S,T)/(EV_PHEV_Max(Y,S,T,IR)*EV_BATTOVERSIZED(Y))))*(EV_PHEV_Max(Y,S,T,IR))*(EV_BATTCOST(Y)*EV_BATTOVERSIZED(Y)/EV_LIFEFACTOR(Y))))$(Y.val>2019))$cs('v2g',Y)



$label  DEGCAL_END3

+ ((SUM((S,T,IR)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND IS3(S)),EV_CHARGERCOST(Y) * EV_BEV_Avail(Y,S,T,IR)))$(Y.val>2019))$cs('v2g',Y)

$label  STEPCHARGSCHEME_END



$ifi %EV_infeas%==yes   +PENALTYQ*(SUM((IR,IS3,T),VQEV_PHEV_SOCBALANCE(Y,IR,IS3,T,'IMINUS') +VQEV_PHEV_SOCBALANCE(Y,IR,IS3,T,'IPLUS')  +VQEV_BEV_SOCBALANCE(Y,IR,IS3,T,'IMINUS') +VQEV_BEV_SOCBALANCE(Y,IR,IS3,T,'IPLUS')))
