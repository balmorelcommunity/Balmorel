* Freeing initial levels to avoid infeasibilities
IF ((ORD(IS3LOOPSET) EQ 1),
$ifi not %HYRSBB123%==cont     VHYRS_S.LO(IY411,IA,IS3LOOPSET)$(ORD(IS3LOOPSET) EQ 1 AND SUM(IGHYRS$IAGK_HASORPOT(IY411,IA,IGHYRS),1))=0;
$ifi not %ADDESTOVOLTS%==cont  VESTOVOLTS.LO(IY411,IA,IGESTOS,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IGESTOS))= 0;
$ifi not %ADDHSTOVOLTS%==cont  VHSTOVOLTS.LO(IY411,IA,IGHSTOS,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IGHSTOS))= 0;
$ifi not %HYRSBB123%==cont     VHYRS_S.UP(IY411,IA,IS3LOOPSET)$(ORD(IS3LOOPSET) EQ 1 AND SUM(IGHYRS$IAGK_HASORPOT(IY411,IA,IGHYRS),1))=INF;
$ifi not %ADDESTOVOLTS%==cont  VESTOVOLTS.UP(IY411,IA,IGESTOS,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IGESTOS))= INF;
$ifi not %ADDHSTOVOLTS%==cont  VHSTOVOLTS.UP(IY411,IA,IGHSTOS,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IGHSTOS))= INF;
$ifi %HYDROGEN%==yes $ifi not %ADDH2STOVOLTS%==cont VHYDROGEN_STOVOL_T.LO(IY411,IA,IHYDROGEN_GH2STO,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IHYDROGEN_GH2STO))=0;
$ifi %HYDROGEN%==yes $ifi not %ADDH2STOVOLTS%==cont VHYDROGEN_STOVOL_T.UP(IY411,IA,IHYDROGEN_GH2STO,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IHYDROGEN_GH2STO))=INF;
$ifi %HYDROGEN%==yes $ifi not %ADDBIOMETHSTOVOLTS%==cont VBIOMETHSTOVOLTS.LO(IY411,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND SUM((IA,IGBIOMETHANE),IAGK_HASORPOT(IY411,IA,IGBIOMETHANE)) AND SUM((IA,IHYDROGEN_GH2TOBIOMETH),IAGK_HASORPOT(IY411,IA,IHYDROGEN_GH2TOBIOMETH)))=0;
$ifi %HYDROGEN%==yes $ifi not %ADDBIOMETHSTOVOLTS%==cont VBIOMETHSTOVOLTS.UP(IY411,IS3LOOPSET,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(T) EQ 1 AND SUM((IA,IGBIOMETHANE),IAGK_HASORPOT(IY411,IA,IGBIOMETHANE)) AND SUM((IA,IHYDROGEN_GH2TOBIOMETH),IAGK_HASORPOT(IY411,IA,IHYDROGEN_GH2TOBIOMETH)))=INF;
$ifi %EV%==yes $ifi %ADDEVSTOS%==none VEV_BE_BEV.LO(IY411,IR,S,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T))=IEV_BEV_available(IY411,S,T,IR) * EV_BEV_emergency(IY411);
$ifi %EV%==yes $ifi %ADDEVSTOS%==none VEV_BE_BEV.UP(IY411,IR,S,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T))=IEV_BEV_available(IY411,S,T,IR) * EV_BEV_batsize(IY411);
$ifi %EV%==yes $ifi %ADDEVSTOS%==none VEV_BE_PHEV.LO(IY411,IR,S,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T))=IEV_PHEV_available(IY411,S,T,IR) * EV_PHEV_emergency(IY411);
$ifi %EV%==yes $ifi %ADDEVSTOS%==none VEV_BE_PHEV.UP(IY411,IR,S,T)$(ORD(IS3LOOPSET) EQ 1 AND ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T))=IEV_PHEV_available(IY411,S,T,IR) * EV_PHEV_batsize(IY411);
);

IF ((ORD(IS3LOOPSET) EQ (CARD(S)-ROLLINGSEASONSNUMBER+1)),
* Fixing again initial storage content from previous runs for consistency in next runs:
$ifi %HYRSBB123%==price    VHYRS_S.FX(IY411,IA,S)$(ORD(S) EQ 1 AND SUM(IGHYRS$IAGK_HASORPOT(IY411,IA,IGHYRS),1) AND IVHYRS_SL(IY411,IA))=  VHYRS_SL(IY411,IA,S);
$ifi %ADDESTOVOLTS%==price VESTOVOLTS.FX(IY411,IA,IGESTOS,S,T)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IGESTOS) AND IESTOVOLTS(IY411,IA,IGESTOS))= ESTOVOLTS(IY411,IA,IGESTOS,S,T);
$ifi %ADDHSTOVOLTS%==price VHSTOVOLTS.FX(IY411,IA,IGHSTOS,S,T)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IGHSTOS) AND IHSTOVOLTS(IY411,IA,IGHSTOS))= HSTOVOLTS(IY411,IA,IGHSTOS,S,T);
$ifi %HYDROGEN%==yes $ifi not %ADDH2STOVOLTS%==price VHYDROGEN_STOVOL_T.FX(IY411,IA,IHYDROGEN_GH2STO,S,T)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND IAGK_HASORPOT(IY411,IA,IHYDROGEN_GH2STO) AND IH2STOVOLTS(IY411,IA,IHYDROGEN_GH2STO))=H2STOVOLTS(IY411,IA,IHYDROGEN_GH2STO,S,T);
$ifi %HYDROGEN%==yes $ifi not %ADDBIOMETHSTOVOLTS%==price VBIOMETHSTOVOLTS.FX(IY411,S,T)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND SUM((IA,IGBIOMETHANE),IAGK_HASORPOT(IY411,IA,IGBIOMETHANE)) AND SUM((IA,IHYDROGEN_GH2TOBIOMETH),IAGK_HASORPOT(IY411,IA,IHYDROGEN_GH2TOBIOMETH)) AND IBIOMETHSTOVOLTS(IY411))=BIOMETHSTOVOLTS(IY411,S,T);
$ifi %ADDPEAKTRANSPORTDEMAND%==yes $ifi %transport%==yes  VTRANSDEMAND_T_MAX.FX(IY411,IR)=TRANSDEMAND_T_MAX(IY411,IR);
*$ifi %EV%==yes VEV_VSOC_BEV.FX(IY411,IR,S,T)$(ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T) AND IBEVSTOVOLTS(IY411,IR))=EV_VSOC_BEV(IY411,IR,S,T);
*$ifi %EV%==yes VEV_VSOC_PHEV.FX(IY411,IR,S,T)$(ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T) AND IPHEVSTOVOLTS(IY411,IR))=EV_VSOC_PHEV(IY411,IR,S,T);


*$ifi %EV%==yes VEV_BE_BEV.FX(IY411,IR,S,T)$(ORD(S) EQ 1 AND ORD(T) EQ 1 AND IBEVSTOVOLTS(IY411,IR))=EV_BE_BEV(IY411,IR,S,T);
*$ifi %EV%==yes VEV_BE_PHEV.FX(IY411,IR,S,T)$(ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T) AND IPHEVSTOVOLTS(IY411,IR))=EV_BE_PHEV(IY411,IR,S,T);
);


*$ifi %EV%==yes VEV_BE_BEV.FX(IY411,IR,S,T)$(ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T) AND IBEVSTOVOLTS(IY411,IR))=EV_BE_BEV(IY411,IR,S,T);
*$ifi %EV%==yes VEV_BE_PHEV.FX(IY411,IR,S,T)$(ORD(S) EQ CARD(S) AND ORD(T) EQ CARD(T) AND IPHEVSTOVOLTS(IY411,IR))=EV_BE_PHEV(IY411,IR,S,T);
